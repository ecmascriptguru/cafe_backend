{% extends 'layouts/adminlte_base.html' %}

{% load crispy_forms_tags %}
{% load i18n %}
{% load static %}

{% block content %}
<section class="content-header">
    <h1>
        <i class="fa fa-dashboard"></i>
        {% trans 'Dashboard' %}
        <small>{% trans 'All sales data available here.' %}</small>
    </h1>
</section>

<section class="content">
    <div class="row">
        <div class="col-xs-12 form-group">
            <form method="GET" class="form">
                {% crispy filter_form %}
                <button type="button" class="btn btn-default pull-left" id="daterange-btn">
                    <span>
                        <i class="fa fa-calendar"></i> 
                        {% trans "Custom Range" as translated_range_option %}
                        {% if request.GET.range_option %}
                            {% if request.GET.range_option == translated_range_option %}
                            {{ request.GET.start_date }} - {{ request.GET.end_date }}
                            {% else %}
                            {{ request.GET.range_option }}
                            {% endif %}
                        {% else %}
                        {% trans 'Select Date Range' %}
                        {% endif %}
                    </span>
                    <i class="fa fa-caret-down"></i>
                </button>

                <div class="form-group pull-left">
                    <select class="form-control select2" id="dashboard-table-selector" multiple="multiple" data-placeholder="{% trans 'Tables' %}" style="width: 100%;">
                        {% for id, name in table_choices %}
                        <option value="{{ id }}" {% if id in table_ids %}selected{% endif %}>{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="pull-right">
                    <button type="submit" class="btn btn-primary"><i class="fa fa-refresh"></i> {% trans 'Refresh' %}</button>
                </div>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-aqua">
                <div class="inner">
                    <h3>{{ report.customers.count }}</h3>
        
                    <p>{% trans 'Customers' %}</p>
                </div>
                <div class="icon">
                    <i class="fa fa-user"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-aqua">
                <div class="inner">
                    <h3>{{ report.orders.count }}</h3>
        
                    <p>{% trans 'New Orders' %}</p>
                </div>
                <div class="icon">
                    <i class="fa fa-shopping-cart"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-aqua">
                <div class="inner">
                    <h3>{{ report.sales.items }}</h3>
        
                    <p>{% trans 'Item Sales' %}</p>
                </div>
                <div class="icon">
                    <i class="fa fa-list"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-aqua">
                <div class="inner">
                    <h3>&yen;{{ report.sales.earning }}</h3>
        
                    <p>{% trans 'Sales' %}</p>
                </div>
                <div class="icon">
                    <i class="fa fa-money"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">{% if request.GET.range_option %}
                        {{ request.GET.range_option }}{% else %}{% trans 'Monthly' %}{% endif %} {% trans 'Report' %}</h3>
        
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                        </button>
                        <div class="btn-group">
                            <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-wrench"></i>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#">{% trans 'Action' %}</a></li>
                                <li><a href="#">{% trans 'Another action' %}</a></li>
                                <li><a href="#">{% trans 'Something else here' %}</a></li>
                                <li class="divider"></li>
                                <li><a href="#">{% trans 'Separated link' %}</a></li>
                            </ul>
                        </div>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                <div class="row">
                    <div class="col-md-8">
                        <p class="text-center">
                            <strong>{% trans 'Sales' %}: <span id="sales-chart-date-range">1 Jan, 2014 - 30 Jul, 2014</span></strong>
                        </p>
        
                        <div class="chart">
                            <!-- Sales Chart Canvas -->
                            <canvas id="salesChart" style="height: 180px;"></canvas>
                        </div>
                        <!-- /.chart-responsive -->
                    </div>
                    <!-- /.col -->
                    <div class="col-md-4">
                        <p class="text-center">
                            <strong>{% trans 'Goal Completion' %}</strong>
                        </p>
        
                        <div class="progress-group">
                            <span class="progress-text">{% trans 'Weekly Customers' %}</span>
                            <span class="progress-number"><b>160</b>/200</span>
        
                            <div class="progress sm">
                                <div class="progress-bar progress-bar-aqua" style="width: 80%"></div>
                            </div>
                        </div>
                        <!-- /.progress-group -->
                        <div class="progress-group">
                            <span class="progress-text">{% trans 'Complete Orders' %}</span>
                            <span class="progress-number"><b>310</b>/400</span>
        
                            <div class="progress sm">
                            <div class="progress-bar progress-bar-red" style="width: 80%"></div>
                            </div>
                        </div>
                        <!-- /.progress-group -->
                        <div class="progress-group">
                            <span class="progress-text">{% trans 'Monthly Earnings' %}</span>
                            <span class="progress-number"><b>480</b>/800</span>
        
                            <div class="progress sm">
                            <div class="progress-bar progress-bar-green" style="width: 80%"></div>
                            </div>
                        </div>
                        <!-- /.progress-group -->
                        <div class="progress-group">
                            <span class="progress-text">{% trans 'Satisfied customers' %}</span>
                            <span class="progress-number"><b>250</b>/500</span>
        
                            <div class="progress sm">
                            <div class="progress-bar progress-bar-yellow" style="width: 80%"></div>
                            </div>
                        </div>
                        <!-- /.progress-group -->
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
                </div>
                <!-- ./box-body -->
                <div class="box-footer">
                    <div class="row">
                        <div class="col-sm-3 col-xs-6">
                            <div class="description-block border-right">
                                <span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 17%</span>
                                <h5 class="description-header">$35,210.43</h5>
                                <span class="description-text">{% trans 'TOTAL REVENUE' %}</span>
                            </div>
                            <!-- /.description-block -->
                            </div>
                            <!-- /.col -->
                            <div class="col-sm-3 col-xs-6">
                            <div class="description-block border-right">
                                <span class="description-percentage text-yellow"><i class="fa fa-caret-left"></i> 0%</span>
                                <h5 class="description-header">$10,390.90</h5>
                                <span class="description-text">{% trans 'TOTAL COST' %}</span>
                            </div>
                            <!-- /.description-block -->
                            </div>
                            <!-- /.col -->
                            <div class="col-sm-3 col-xs-6">
                            <div class="description-block border-right">
                                <span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 20%</span>
                                <h5 class="description-header">$24,813.53</h5>
                                <span class="description-text">{% trans 'TOTAL PROFIT' %}</span>
                            </div>
                            <!-- /.description-block -->
                            </div>
                            <!-- /.col -->
                            <div class="col-sm-3 col-xs-6">
                            <div class="description-block">
                                <span class="description-percentage text-red"><i class="fa fa-caret-down"></i> 18%</span>
                                <h5 class="description-header">1200</h5>
                                <span class="description-text">{% trans 'GOAL COMPLETIONS' %}</span>
                            </div>
                            <!-- /.description-block -->
                        </div>
                    </div>
                <!-- /.row -->
                </div>
                <!-- /.box-footer -->
            </div>
            <!-- /.box -->
        </div>
    </div>
</section>
{% endblock %}

{% block custom_js %}
<script>
    $(function() {
        {% if request.GET.start_date and request.GET.end_date %}
        window.startDate = moment("{{ request.GET.start_date }}")
        window.endDate  = moment("{{ request.GET.end_date }}")
        {% else %}
        window.startDate = moment().subtract(29, "{% trans 'days' %}")
        window.endDate = moment()
        {% endif %}
    })
</script>
<script>
    $(function () {
        //
        $("#sales-chart-date-range").text(`${window.startDate.format('YYYY-MM-DD')} - ${window.endDate.format('YYYY-MM-DD')}`)
        //Initialize Select2 Elements
        $('.select2').select2()
    
        //Date range as a button
        $('#daterange-btn').daterangepicker(
            {
                ranges: {
                    "{% trans 'Today' %}": [moment(), moment()],
                    "{% trans 'Yesterday' %}": [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    "{% trans 'Last 7 Days' %}": [moment().subtract(6, 'days'), moment()],
                    "{% trans 'Last 30 Days' %}": [moment().subtract(29, 'days'), moment()],
                    "{% trans 'This Month' %}": [moment().startOf('month'), moment().endOf('month')],
                    "{% trans 'Last Month' %}": [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                },
                startDate: window.startDate,
                endDate  : window.endDate
            },
            function (start, end, range_option) {
                let start_date = start.format('YYYY-MM-DD'),
                    end_date = end.format('YYYY-MM-DD')
                $("#dashboard_start_date").val(start_date)
                $("#dashboard_end_date").val(end_date)
                $("#dashboard_date_range_option").val(range_option)
                $('#daterange-btn span').html(`${start_date} - ${end_date}`)
            }
        )

        $(document)
        .on('change', '#dashboard-table-selector', function() {
            $("#dashboard_tables").val($(this).val().join(','))
        })
    })
    </script>
    <script src="{% static 'backend_theme/js/dashboard.js' %}"></script>
{% endblock %}